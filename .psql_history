\d
select * from events order by time desc limit 10;
select * from events order by time desc limit 10;
select * from events order by time desc limit 10;
select * from events order by time desc limit 20;
q
\q
create table devices (number integer, name textvoice textclosed_bit integer );
create table devices (number integer, name text,voice text,closed_bit integer );
\d devices
insert into devices (number,name,voice,closed_bit) values(1002250, 'back door', 'back door open', 32 );
insert into devices (number,name,voice,closed_bit) values(364457, 'fron door', 'front door open', 32 );
insert into devices (number,name,voice,closed_bit) values(294481, 'addison door', 'addison door open', 32 );
insert into devices (number,name,voice,closed_bit) values(843848, '1st floor right window', 'right window open', 32 );
insert into devices (number,name,voice,closed_bit) values(978804, '1st floor left window', 'left window open', 32 );
insert into devices (number,name,voice,closed_bit) values(892860, 'motion waverly', 'motion waverly', 32 );
insert into devices (number,name,voice,closed_bit) values(939896, 'motion addison', 'motion addison', 128 );
insert into devices (number,name,voice,closed_bit) values(788933, '2nd floor left window', '2nd floor left window open', 32 );
insert into devices (number,name,voice,closed_bit) values(813391, '2nd floor left window', '2nd floor left window open', 32 );
insert into devices (number,name,voice,closed_bit) values(244222, 'basement fire', 'basement fire', 128 );
insert into devices (number,name,voice,closed_bit) values(707641, '2nd floor fire', '2nd floor fire', 128 );
insert into devices (number,name,voice,closed_bit) values(179122, 'addison fire', 'addison fire', 128 );
insert into devices (number,name,voice,closed_bit) values(706360, '3rd floor fire', '3rd floor fire', 128 );
selct * from devices;
select * from devices;
modify table devices add column type text;
alter table devices add column type text;
select * from devices;
update devices set name = 'front door' where number = 364457;
select * from devices;
update devices set name = '2nd floor right window' voice = '2nd floor right window' where number = 813391;
update devices set name = '2nd floor right window' and voice = '2nd floor right window' where number = 813391;
update devices set name = '2nd floor right window'  where number = 813391;
update devices set voice = '2nd floor right window'  where number = 813391;
select * from devices;
update devices set closed_bit = 128 where number = 892860;
select * from devices;
alter table devices set type = 'door' where number in (1002250,294481,364457);
update table devices set type = 'door' where number in (1002250,294481,364457);
update devices set type = 'door' where number in (1002250,294481,364457);
update devices set type = 'motion' where number in (892860,939896);
select * from devices;
update devices set type = 'fire' where number in (244222,707641,179122,706360);
select * from devices;
update devices set type = 'window' where number in (843848,978804,788933,813391);
select * from devices;
\q
select * from devices;
\d
select * from status;
select * from events where flag = true order by time desc;
\q
\d
select * from status;
select * from events where flag = true order by time desc limit 50;
create function door_alert(text) as  '#!/bin/bashecho door alert $1' LANGUAGE plsh;
\q
create function door_alert(text) as  '#!/bin/bashecho door alert $1' LANGUAGE plsh;
\q
create function door_alert(text) as  '#!/bin/bashecho door alert $1' LANGUAGE plsh;
create function door_alert(text) RETURNS integer as  '#!/bin/bashecho door alert $1' LANGUAGE plsh;
\d
\dx
\q
select * from events;
select * from events limit 5;
insert into events (source, event, flag, code) values('motion_waverly','motion',true,128);
\q
select * from events limit 5;
select * from status;
\d status
\d+ status
select distinct on (events.source) events.source,events.time,events.event, events.flag, events.code from eventswhere flag = trueORDER BY events.source, events."time" DESC;
select distinct on (events.source) events.source,events.time,events.event, events.flag, events.code from eventswhere flag = trueORDER BY events.source, events."time" DESC;
\q
select * from lastalert;
select * from events where source like '%addison%' and flag = true;
select * from events where source like '%addison%' and flag = true order by time desc;
select * from events where  flag = true order by time desc;
select * from events where  flag = true order by time desc and time < '2019-07-16 05:00:00';
select * from events where  flag = true and time < '2019-07-16 05:00:00' order by time desc;
select * from events where  flag = true and time < '2019-07-16 06:00:00' order by time desc;
\q
select * from lastalert;
select * from status;
select * from events;
select * from events order by time;
\q
select * from lastalert;
select * from status;
\q
select * from status;
select * from lastalert;
\q
select * from status;
select * from lastalert;
select * freom events order by time desc;
select * from events order by time desc;
\q
select * from events order by time desc;
select * from lastalert;
select * from lastalert ;
select * from status ;
\q
\d
select * from status;
\q
\d
drop table item0001;
drop table item0002;
drop table item0003;
drop table item0004;
drop table item0005;
drop table item0006;
drop table item0007;
drop table item0008;
drop table item0009;
drop table item0010;
drop table item0011;
drop table item0012;
drop table item0013;
drop table item0014;
\d
drop sequence items_itemid_seq;
drop table items;
drop sequence items_itemid_seq;
\d
\d events
select * from devices;
insert into devices (number, name, voice, closed_bit, type), values(629466, 'basement water', 'basement water', 16, 'water');
insert into devices (number, name, voice, closed_bit, type) values(629466, 'basement water', 'basement water', 16, 'water');
insert into devices (number, name, voice, closed_bit, type) values(500909, 'basement window', 'basement window', 16, 'window');
insert into devices (number, name, voice, closed_bit, type) values(83309, 'garage door', 'garage door', 128, 'door');
select * from devices;
update devices set closed_bit = 128 hwere name = 'basement window';
update devices set closed_bit = 128 where  name = 'basement window';
\q
\d
select * from status;
ls
\q
\d
select * from events sort by time desc;
select * from events sort time desc;
select * from events order by time desc;
select * from events where source like '%back%' order by time desc;
\q
select * from status;
select * from status where flag = 't';
select count(source) from status where flag = 't';
select count(source) from status where flag = 't';
select count(source) from status where flag = 't';
select * from status where flag = 't';
\q
\d
select  from state;
select * from state;
update state set enabled = true where category = 'alarm-stay';
\q
\d events
\q
\d events
\q
drop function water_alert;
drop function water_alert();
drop function door_alert() ;
drop cascade function door_alert() ;
drop function door_alert() cascade ;
drop function alarm_alert() cascade ;
drop function fire_alert() cascade ;
\d events
\d events
\i trigger
\d events
\df
drop function door_chime_function();
\df
select * from state;
\q
select * from state;
select * from status;
delete from events where source = '';
update events set source = 'basement_window' where source = 'basement window';
update events set source = 'basement_water' where source = 'basement water';
select * from status;
select * from lastalert;
select count(*) from events;
ls
\q
\d
\d events
\d+ status
create index source_index on events(source);
\d events
\w
\q
\d events
\q
select * from devices;
update devices set name = 'addison_fire' where name = 'addison fire';
update devices set name = '3rd_floor_fire' where name = '3rd floor fire';
update devices set name = '1st_floor_right_window' where name = '1st floor right window';
update devices set name = '2nd_floor_right_window' where name = '2nd floor right window';
update devices set name = '2nd_floor_left_window' where name = '2nd floor left window';
update devices set name = '1st_floor_left_window' where name = '1st floor left window';
select * from devices;
select * from devices;
update name = 'garage_door' where name  = 'garage door';
update devices set name = 'garage_door' where name  = 'garage door';
update devices set name = 'basement_window' where name  = 'basement window';
select * from devices;
update devices set name = 'basement_water' where name  = 'basement water';
update devices set name = 'basement_water' where name  = 'basement water';
select * from devices;
\q
select * from devices;
q\
\q
\d
selet * from actions;
select * from actions;
\q
select * from devices;
update devices set number = '201638' where number = '1002250';
\q
select count(source) from status where flag = 't';
select * from status where flag = t;
select * from status where flag = true;
delete from status where time = '2019-08-06 18:26:00' and flag = true;
delete from events where time = '2019-08-06 18:26:00' and flag = true;
select * from events where source = 'back_door' and code = 224;
select * from events where source = 'back_door' and code = 224 and time = '2019-08-06 18:26:54.503881';
delete  from events where source = 'back_door' and code = 224 and time = '2019-08-06 18:26:54.503881';
\q
select * from lastalert;
\q
select * from status;
select * from events whre source like '2nd_floor_left%' order by time desc;
select * from events where source like '2nd_floor_left%' order by time desc;
select * from lastalert;
select * from lastalert;
select * from events whre source like '2nd_floor_left%' order by time desc;
select * from status;
\w
\q
select * from status;
select * from lastalert;
\d lastalert
\d+  lastalert
\d+ status
\d
select * from devices;
\q
select * from status;
\w
\q
select * from status;
select * from status;
select * from status;
select * from status;
select * from status;
select * from events where source = 'back_door' order by time desc;
select * from events where source = 'addison_door' order by time desc;
select * from lastalert;
select * from status;
select * from status;
\q
select * from events order by time desc;
\q
select * from status;
\q
\d+ lastalert
\d+ status
select * from status;
\q
select * from status;
\q
select * from status;
select * from devices;
alter table devices add column priority integer default 0;
select * from devices;
update devices set priority = 1 where name like '%fire%' or  name like '%water%';
select * from devices;
\q
select * from events where source = 'addison_door' order by time desc;
select * from events where source = 'addison_door' and flag = true  order by time desc;
\q
select * from events where source = 'addison_door' and flag = true  order by time desc;
select * from events where source = 'back_door' and flag = true  order by time desc;
select * from events where source = 'back_door'  order by time desc;
select * from events where source like '%water%'  order by time desc;
select count(*) from events;
select count(*) from events;
select count(*) from events;
select count(*) from events;
select * from events   order by time desc;
select * from events  where status = 'open'  order by time desc;
select * from events   order by time desc;
select * from events  where event = 'open'  order by time desc;
\q
select * from events  where event = 'open'  order by time desc;
\q
\d
select * from actions order by date desc;
select * from actions order by time desc;
select * from events   order by time desc;
select * from events  where source = 'back_door'  order by time desc;
select * from lastalert;
\q
select * from devices;
\q
select * from lastalert;
select * from events where source = 'basement_window' order by time desc;
exit
\q
select * from events where source = 'basement_window' order by time desc;
select * from events where source = 'back_door' order by time desc;
select * from events where source = 'basement_water' order by time desc;
lstop
\q
\d
select * from lastalert;
select * from events where flag=true and source'front_door' order by time desc;
select * from events where flag=true and source = 'front_door' order by time desc;
select * from events where  source = 'front_door' order by time desc;
select * from events where  source = 'front_door' order by time desc;
select * from events where  source = 'front_door' and (code = 128 or code = 160) order by time desc;
select * from events where  source = 'front_door' order by time desc;
select * from events where  source = 'front_door' and (code & 4 = 0) order by time desc;
select * from events where  source = 'front_door' order by time desc;
select * from events where  source = 'front_door' and (code & 4 = 0) order by time desc;
select * from events where  source = 'front_door' order by time desc;
select * from events where  source = 'front_door' and (code & 4 = 0) order by time desc;
\d
select * from actions;
select * from actions order by time desc;
select * from events where  source = '2nd_floor_fire' order by time desc;
\q
select * from events where  source = '2nd_floor_fire' order by time desc;
\q
select * from events where  source = 'front_door' and (code & 4 = 0) order by time desc;
\q
select * from events where  source = 'front_door' and (code & 4 = 0) order by time desc;
exitexit
\
\q
select * from events where  source = 'front_door' and (code & 4 = 0) order by time desc;
select * from events where  source = 'back_door' and (code & 4 = 0) order by time desc;
select * from events where  source = 'garage_door' and (code & 4 = 0) order by time desc;
select * from events where  source = 'back_door' and (code & 4 = 0) order by time desc;
select * from events where  source = 'back_door' and (code & 4 = 0) order by time desc;
select * from events where  source like  '%window' and (code & 4 = 0) order by time desc;
select * from events where  source like  'addison_door' and (code & 4 = 0) order by time desc;
\d
select * from status;
select * from events where  source like  'motion_waverly' and (code & 4 = 0) order by time desc;
select * from events where  source = 'front_door' and (code & 4 = 0) order by time desc;
select * from events where  source like  '%water' and (code & 4 = 0) order by time desc;
select * from events where  source like  '%fire' and (code & 4 = 0) order by time desc;
\q
\d
select * from events;
select * from events where source = 'motion_waverly';
select * from events where source = 'motion_waverly' and flag = true;
select * from events where source = 'motion_waverly' and flag = true group by date_trunc('hour', time);
select time  from events where source = 'motion_waverly' and flag = true group by date_trunc('hour', time);
select time  from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time);
select count(time)  from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time);
select count(source)  from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time);
select date_trunc('hour', time), count(source)  from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time);
select date_trunc('hour', time)    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time);
select count(date_trunc('hour', time)), date_trunc('hour', time)    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time);
select count(date_trunc('hour', time)), date_trunc('hour', time)    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc;
select date_trunc('hour', time)    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc;
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a, ggroup by time;
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a;
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time;
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time order by a.time desc;
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time order by a.time desc;
\a
\o  time.csv
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time order by a.time desc;
\q
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time order by a.time desc;
exitexit
\q
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time order by a.time desc;
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time order by a.time desc;
select time, count(time) from (select date_trunc('hour', time) as time    from events where source = 'motion_waverly' and flag = true group by time, date_trunc('hour', time) order by time desc) a group by a.time order by a.time desc;
\q
\d
select * from events;
select * from events order by time desc;
select * from actions  order by time desc;
\q
\d
select * from events where source = 'back_door' order by time desc;
select * from lastalert;
\d
select * from status;
select * from state;
\d
select * from actions;
select * from actions order by time desc;
\q
\d
select * from events;
select * from events order by time desc;
\q
select * from events where source = '2nd_floor_fire' order by time desc;
select * from events where source = '2nd_floor_window_left' order by time desc;
select * from events where source like '2nd_floor_%' order by time desc;
select * from events where source like '2nd_floor_%' order by time desc;
select * from events where source like '3nd_floor_%' order by time desc;
select * from events where source like '3rd_floor%' order by time desc;
select count(*) from events;
\q
\q
\d
\d+
\d+ data
select * from data;
select * from data group by name;
select name, max(time), temperature from data group by name;
select name, max(time), temperature from data group by name, temperature;
select name, max(time), ave(temperature) from data group by name, temperature;
select name, max(time), avg(temperature) from data group by name, temperature;
select distinct name, max(time), ave(temperature) from data group by name, temperature;
select distinct name, max(time), temperature from data group by name, temperature;
select distinct on name name, max(time), temperature from data group by name, temperature;
select distinct on(name) name, max(time), temperature from data group by name, temperature;
select distinct on(name) name, max(time), temperature from data where time = max(time) group by name, temperature;
select distinct on(name) name, time, temperature from data group by name, temperature;
select distinct on(name) name, time, temperature from data group by name, time, temperature;
select distinct on(name) name, time, temperature from data where time = (select max(time) from temperature) group by name, time, temperature;
select distinct on(name) name, time, temperature from data where time = (select max(time) from temperature) group by name, time, temperature;
select distinct on(name) name, time, temperature from data where time = (select max(time) from temperature) and temperature < 55 group by name, time, temperature;
select distinct on(name) name, time, temperature from data where time = (select max(time) from temperature) and name != 'outside' and temperature < 55 group by name, time, temperature;
\q
select * from devices;
\q
\d 
select * from status;
select * from lastevent;
\d
select * from lastalert;
\d
select * from state;
\q
select * from events order by time desc;
\d events
\d
\h create view
create view open as select count(source) from status where flag = 't' or not event in (select distinct normal from devices);
select * from open;
select * from open;
create or replace view open as select source, to_char(time, 'dd Mon yyyy hh24:mi') as time, event from status where not event in (select distinct normal from devices);
drop view open;
create or replace view open as select source, to_char(time, 'dd Mon yyyy hh24:mi') as time, event from status where not event in (select distinct normal from devices);
select * from open;
select * from open;
explain analyze select * from  lastalert;
explain analyze select * from  lastalert;
explain analyze select * from  lastalert;
\q
